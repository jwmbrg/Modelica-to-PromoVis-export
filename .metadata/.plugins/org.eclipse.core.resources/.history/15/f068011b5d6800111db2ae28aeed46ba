'''
Created on Mar 7, 2012

@author: Jesper Moberg
'''
import pmv_tf
import pmv_variable
class pmv_scenario(object):
    '''
    classdocs
    '''
    
    class _type_params(object):
        _input=0
        _state=1
        _disturbance=2
        
    def __init__(self,E,A,B,F,g,state_names, input_names,algebraic_names):
        '''
        Constructor
        Assumes E to be identity
        '''
        self.E=E
        self.A=A
        self.B=B
        self.F=F
        self.g=g
        self.state_names=state_names
        self.input_names=input_names
        self.algebraic_names=algebraic_names
        self.varArr=self.createModel();
        
        
    def createModel(self):
       
        return [ self.createStateVar(0),self.createStateVar(1)]
    
    
    def createStateVar(self,index):
        name=self.state_names[index]
        print name
        typ=self._type_params._state
        
        
        dividerCoeff=self.E[index][index]
        print "dividerarn"
        print dividerCoeff
        
        coeffarr=self.A[index]
        #create the common denominator
        i=0
        from operator import mul

        for element in coeffarr:
            if(i==index):
                denominator=array([1, -element])*dividerCoeff
                denominator=denominator*dividerCoeff
                print "din mamma"
                print denominator
            i+=1
        print "denominator" 
        print denominator
        print "index"
        print index
        
        
        #find all numerators for states, and input the common denominator
        state=0
        state_dict={}
        for  element in coeffarr:
            print element
            if(element!=0 and state!=index):
                numerator=[element]
                varName=self.state_names[state]
                tf=pmv_tf.pmv_tf(numerator,denominator,varName)
                state_dict[varName]=tf
                print state_dict
            state+=1
        #find transfer function
      
    
        input_dict=0
        disturbance_dict=0
        toReturn= pmv_variable.pmv_variable(name,typ,state_dict,input_dict,disturbance_dict)
        
        return toReturn